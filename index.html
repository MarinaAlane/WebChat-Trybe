<!DOCTYPE html>
<html>

<head>
    <title>Socket IO - Trybe</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: sans-serif;
            box-sizing: border-box;
        }
    </style>
    <script src="/socket.io/socket.io.js"></script>
  
</head>
<body>
    <div id="div-nickname">
        <input id="nicknameInput" data-testid="nickname-box" />
        <button id="btn-nickname" data-testid="nickname-button" type="button">OK</button>
    </div>
    <ul id="messages"></ul>

    <form action="" id="form">
        <input id="mensagemInput" data-testid="message-box" autocomplete="off" />
        <button data-testid="send-button" >Send</button>
    </form>

    <script>
       const socket = io();
       const form = document.querySelector('#form');
       const inputMessage = document.querySelector('#mensagemInput')
       const nicknameBtn = document.querySelector('#btn-nickname');
       form.addEventListener('submit', (e) => {
           e.preventDefault();
           const span = document.querySelector('span');
           console.log(span.innerText);
           if(inputMessage.value) {
             const data = {
                 nickname: span.innerText,
                 chatMessage: inputMessage.value,
             }
             console.log(data);
                socket.emit('message', data);
                inputMessage.value = '';
              }  
         });

            socket.on('message', (message) => {
                const ul = document.querySelector('#messages');
                console.log(message);
                const { dataAtual, horaAtual, nickname, chatMessage } = message;
                const li = document.createElement('li');
                li.setAttribute("data-testid", "message");
                li.textContent = message;
                ul.appendChild(li);
            });
            
            nicknameBtn.addEventListener('click', () => {
                const inputNickname = document.querySelector('#nicknameInput');
                const div = document.querySelector('#div-nickname');
                const dSpan = document.querySelector('span');
                div.removeChild(dSpan);
                const span = document.createElement('span');
                span.setAttribute("data-testid", "online-user");
                span.textContent = inputNickname.value;
                div.appendChild(span);
            });

            window.onload = () => {
                let nickname = document.getElementById('nickname');
                let radomString = [...Array(16)].map(i=>(~~(Math.random()*36)).toString(36)).join('')
                console.log(radomString);
                const div = document.querySelector('#div-nickname');
                const span = document.createElement('span');
                span.setAttribute("data-testid", "online-user");
                span.textContent = radomString;
                div.appendChild(span);
            }

    </script>

</body>

</html>
